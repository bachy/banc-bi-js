function init(){function e(){r=m.socket.sessionid,console.log("Connected "+r)}function n(e){console.log("incomingLine",e),d(e)}function i(e){console.log("new image :: data",e);var n=$('.column.images[foldername="'+e.folder+'"] .thumbs'),i=$('.column.images[foldername="'+e.folder+'"] select'),o=Math.floor(n.find("img:last").attr("index"))+1;n.addClass("new-image").append($("<img>").addClass("thumb").attr("index",o).attr("alt","").attr("src",e.src).hide()),n.removeClass("new-image"),i.append($("<option>").attr("index",o).attr("value",e.img).html(e.img))}function o(e){console.log("Unable to connect to server",e)}function t(){var e={};e.legend=$("#legend").val(),e.images={},$("#lineForm .column.images").each(function(){e["image-"+$(this).attr("foldername")]=$(this).find('option[selected="selected"]').val()}),console.log("data",e),$.ajax({url:"/newline",type:"POST",dataType:"json",data:e})}function a(e){var n;e.deltaY>0?n=$(this).find("img:visible").next().size()?$(this).find("img:visible").next():$(this).find("img:first-child"):e.deltaY<0&&(n=$(this).find("img:visible").prev().size()?$(this).find("img:visible").prev():$(this).find("img:last-child")),s($(this).parents(".column"),parseInt(n.attr("index")))}function l(){console.log("onImageRangeChange"),s($(this).parents(".column"),$(this).val()-1)}function s(e,n){console.log("changeVisibleImage",n),e.find("img").hide(),$('img[index="'+n+'"]',e).show(),$("option",e).removeAttr("selected"),$('select option[index="'+n+'"]',e).attr("selected",!0),$('input[type="range"]',e).val(n+1)}function d(e){var n=$("<article>").addClass("record row lead").append($("<p>").addClass("legend column col-xs-3").html(e.legend));for(folder in e.images){var i="/images/"+folder+"/"+e.images[folder];n.append($("<div>").addClass("column col-xs-3").append($("<img>").addClass("thumb").attr("src",i)))}n.appendTo("#recordedlines")}var c=document.domain,m=io.connect(c),r="";m.on("connect",e),m.on("incomingLine",n),m.on("error",o),m.on("newImage",i),$("#send").on("click",t),$(".column .thumbs").on("mousewheel",a),$('.column input[type="range"]').on("change",l)}$(document).on("ready",init);